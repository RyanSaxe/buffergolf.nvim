#!/usr/bin/env bash

# Simple test runner with optional coverage reporting

# Clean up old coverage files
rm -f luacov.stats.out luacov.report.out

# Run tests using mini.test via the minit.lua bootstrap
# Coverage is always enabled if luacov is available
nvim -l tests/minit.lua --minitest
EXIT_CODE=$?

# Show coverage report if requested and tests passed
if [[ "$1" == "--coverage" ]] && [ $EXIT_CODE -eq 0 ]; then
  echo ""
  echo "Coverage Report:"
  echo "================"

  if [ -f luacov.report.out ]; then
    # Show summary from the report
    tail -20 luacov.report.out
  else
    echo "No coverage report generated. You may need to install luacov."
    echo "Install with: luarocks install luacov"
  fi
fi

exit $EXIT_CODE